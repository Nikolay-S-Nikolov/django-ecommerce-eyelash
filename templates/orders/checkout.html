{% extends 'base.html' %}
{% load cart_item_summary_tag %}
{% load show_field_error %}

{% block body %}
{%include 'partials/messages.html' %}
 <div class="checkout-container">
        <h2 class="checkout-header">Завършване на поръчката</h2>
        <form action="{% url 'checkout' %}" method="post">
            <div class="row-left">
                <div class="col">
                    <div class="card">
                        <div class="card-body">
                            <h3 class="card-title">Данни за доставка</h3>
                            {% csrf_token %}
                            <div class="mb-3">
                                {{ form.name.label_tag }}
                                {{ form.name}}
                                {% render_field_errors form.name %}
                            </div>
                            <div class="mb-3">
                                {{ form.phone_number.label_tag }}
                                {{ form.phone_number }}
                                {% render_field_errors form.phone_number %}
                            </div>
                            <div class="mb-3">
                                {{ form.email.label_tag }}
                                {{ form.email }}
                                {% render_field_errors form.email %}
                            </div>
                            <div class="mb-3">
                                {{ form.address.label_tag }}
                                {{ form.address }}
                                {% render_field_errors form.address %}
                            </div>
                            <div class="mb-3">
                                {{ form.city.label_tag }}
                                {{ form.city }}
                                {% render_field_errors form.city %}
                            </div>
                            <div class="mb-3">
                                {{ form.postal_code.label_tag }}
                                {{ form.postal_code }}
                                {% render_field_errors form.postal_code %}
                            </div>
                            <div class="mb-3">
                                {{ form.note.label_tag }}
                                {{ form.note }}
                                {% render_field_errors form.note %}
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Order Summary -->
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-body">
                            <h3 class="card-title">Поръчка</h3>
                            <table class="table">
                                <thead>
                                <tr>
                                    <th>Продукти</th>
                                    <th>Цена</th>
                                </tr>
                                </thead>
                                <tbody>
                                {% for item in cart_items %}
                                    <tr>
                                        <td>{{ item.product.name }} × {{ item.quantity }}</td>
                                        <td> - {{ item.product.price|multiply:item.quantity }} лв</td>
                                    </tr>
                                {% endfor %}
                                </tbody>
                                <tfoot>
                                <tr>
                                    <th>Обща сума</th>
                                    <th>{{ total }} лв</th>
                                </tr>
                                </tfoot>
                            </table>
                            <div class="mb-3 m-4">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="payment_method"
                                           id="payOnDelivery"
                                           value="pay_on_delivery" checked>
                                    <label class="form-check-label" for="payOnDelivery">
                                        Наложен платеж
                                    </label>
                                    <small class="form-text text-muted">Заплатете сумата директно на куриера при получаване на поръчката. Не се изисква авансово плащане.</small>
                                </div>
                            </div>
                            <div class="mb-3 m-4">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="payment_method" id="bankPayment"
                                           value="bank_payment">
                                    <label class="form-check-label" for="bankPayment">
                                        Банков превод
                                    </label>
                                    <small class="form-text text-muted">Преведете сумата директно по нашата банкова сметка. Използвайте номера на поръчката като основание за плащането. Поръчката ще бъде обработена след потвърждаване на плащането.</small>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary btn-block">Place Order</button>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
{% endblock %}